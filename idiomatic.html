

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Idiomatic D &mdash; Pragmatic D Tutorial</title>
    
    <link rel="stylesheet" href="_static/marcelene.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Pragmatic D Tutorial" href="index.html" />
    <link rel="next" title="Meta Programming" href="meta.html" />
    <link rel="prev" title="Optimization" href="optimization.html" /> 
  </head>
  <body>
    <div class="header-wrapper">
      <div class="header">
        <div class="headertitle"><a
          href="index.html">Pragmatic D Tutorial</a></div>
        <div class="rel">
          <a href="optimization.html" title="Optimization"
             accesskey="P">previous</a> |
          <a href="meta.html" title="Meta Programming"
             accesskey="N">next</a>
        </div>
       </div>
    </div>

    <div class="content-wrapper">
      <div class="content">
        <div class="document">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="idiomatic-d">
<h1>Idiomatic D<a class="headerlink" href="#idiomatic-d" title="Permalink to this headline">¶</a></h1>
<p>The D community is relatively young and small,
so there is not that much experience about best practices.
Nevertheless, due to runtime and standard library
certain characteristics can be considered idiomatic.</p>
<div class="section" id="constness">
<h2>Constness<a class="headerlink" href="#constness" title="Permalink to this headline">¶</a></h2>
<p>D provides <tt class="docutils literal"><span class="pre">const</span></tt> and <tt class="docutils literal"><span class="pre">immutable</span></tt> keywords.
While const means, I cannot change the value,
immutable means nobody can change the value,
which is a stronger guarantee.</p>
<p>You can cast immutable to const, but not in reverse.
Also, you can cast mutable to const.
This means functions taking const arguments,
take mutable and immutable values.</p>
<p>In contrast to C, <tt class="docutils literal"><span class="pre">const</span></tt> is transitive,
which means anything you get out of a const is also const.
In other words,
a const object cannot have mutable members.</p>
<div class="section" id="when-to-use-what">
<h3>When to use what?<a class="headerlink" href="#when-to-use-what" title="Permalink to this headline">¶</a></h3>
<p>Here are some guidelines.
Note the &#8220;should&#8221;,
because no guideline is correct in all cases.</p>
<ul class="simple">
<li>Arguments should be const, so mutable and immutable values can be given.<ul>
<li>However, do not copy arguments to make them mutable or immutable,
instead declare the argument mutable or immutable from the start
and let the caller make the copy.</li>
<li>If a function is not thread-safe due to const arguments,
either explicitly document this or make the arguments immutable.</li>
</ul>
</li>
<li>Return values, which are freshly constructed, should never be const, but mutable or immutable.</li>
<li>Data structures should not restrict themselves to be mutable, const, or immutable.
The user should decide about mutability.
Test this.
Otherwise future changes could break users code.</li>
</ul>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference external" href="http://dlang.org/const-faq.html">Const FAQ</a>,
<a class="reference external" href="http://dlang.org/const3.html">Const and Immutable</a>,
<a class="reference external" href="http://dconf.org/2013/talks/cehreli.html">Copy and Move Semantics in D, talk by Ali Çehreli</a>,
<a class="reference external" href="http://forum.dlang.org/post/sdefkajobwcfikkelxbr&#64;forum.dlang.org">Discussion on these guidelines</a></p>
</div>
</div>
</div>
<div class="section" id="purity">
<h2>Purity<a class="headerlink" href="#purity" title="Permalink to this headline">¶</a></h2>
<p>Try to make your functions <tt class="docutils literal"><span class="pre">pure</span></tt> and <tt class="docutils literal"><span class="pre">nothrow</span></tt> and <tt class="docutils literal"><span class="pre">&#64;safe</span></tt>.</p>
<ul class="simple">
<li>Pure means your function does not use or change mutable global state
except what is available from the arguments.
If in addition the arguments are not mutable, a function is called &#8220;strongly pure&#8221;.</li>
<li>Nothrow means your function will never throw an exception.</li>
<li>Safe means your function cannot break the type system via unsafe casts or inline assembly.</li>
</ul>
<p>These qualifiers are required of called functions as well.
For example, a pure function can only call pure functions.</p>
<p>For the record,
everybody mostly agrees that these parameters should be the default
and some &#8220;impure&#8221;, &#8220;throw&#8221;, and &#8220;unsafe&#8221; attributes with inverse meaning would be better.
However, changing it would break too much code at this point.</p>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference external" href="http://klickverbot.at/blog/2012/05/purity-in-d/#pure_member_functions">Purity in D</a></p>
</div>
</div>
<div class="section" id="ranges">
<h2>Ranges<a class="headerlink" href="#ranges" title="Permalink to this headline">¶</a></h2>
<p>Instead of iterators,
D promotes ranges,
which can be described as a pair of iterators.
Ranges capture the concept of sequential access,
which is available for arrays, lists, files, and sockets.
There are various kinds of ranges,
depending, for example, on whether random access is possible.</p>
<p>For an example,
consider the expression <tt class="docutils literal"><span class="pre">sort(chain(a,b,c))</span></tt>,
where <tt class="docutils literal"><span class="pre">sort</span></tt> and <tt class="docutils literal"><span class="pre">chain</span></tt> are ordinary functions from the standard library.
Like the name suggests,
<tt class="docutils literal"><span class="pre">sort</span></tt> is the sorting function
and <tt class="docutils literal"><span class="pre">chain</span></tt> wraps multiple ranges into one.
If <tt class="docutils literal"><span class="pre">a</span></tt>, <tt class="docutils literal"><span class="pre">b</span></tt>, and <tt class="docutils literal"><span class="pre">c</span></tt> are random access arrays,
then <tt class="docutils literal"><span class="pre">sort</span></tt> can perform in-place over three distinct arrays.</p>
<p>This tutorial will not explore ranges deeper,
because the topic is quite big.
Instead, there are a few links.</p>
<blockquote>
<div>I think ranges are really cool, and well deserving of a book treatment. Someone should write it.
– <a class="reference external" href="http://www.reddit.com/r/IAmA/comments/1nl9at/i_am_a_member_of_facebooks_hhvm_team_a_c_and_d/ccjly9n">Andrei Alexandrescu</a></div></blockquote>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference external" href="http://dlang.org/phobos/std_range.html">std.range</a>,
<a class="reference external" href="http://www.informit.com/articles/printerfriendly.aspx?p=1407357&amp;rll=1">On Iteration</a>,
<a class="reference external" href="http://wiki.dlang.org/Component_programming_with_ranges">Component Programming with Ranges</a>,
<a class="reference external" href="http://ddili.org/ders/d.en/ranges.html">Ranges by Ali Çehreli</a></p>
</div>
</div>
<div class="section" id="compile-time-function-evaluation">
<h2>Compile Time Function Evaluation<a class="headerlink" href="#compile-time-function-evaluation" title="Permalink to this headline">¶</a></h2>
<p>Since D allows to call certain D code at compile time,
a library writer should enable her functions for compile time evaluation.
This often means to write code according to the functional programming paradigm.</p>
</div>
<div class="section" id="scope-guards">
<h2>Scope Guards<a class="headerlink" href="#scope-guards" title="Permalink to this headline">¶</a></h2>
<p>Scope guards make try-finally (without catch!) constructs obsolete and improve upon them.
This often comes up with locks.</p>
<div class="highlight-d"><div class="highlight"><pre><span class="k">try</span> <span class="p">{</span>
  <span class="n">l</span><span class="p">.</span><span class="n">lock</span><span class="p">();</span>
  <span class="c1">// mutual exclusion stuff</span>
<span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
  <span class="n">l</span><span class="p">.</span><span class="n">unlock</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Becomes</p>
<div class="highlight-d"><div class="highlight"><pre><span class="p">{</span>
  <span class="n">l</span><span class="p">.</span><span class="n">lock</span><span class="p">();</span>
  <span class="k">scope</span> <span class="p">(</span><span class="n">exit</span><span class="p">)</span> <span class="n">l</span><span class="p">.</span><span class="n">unlock</span><span class="p">();</span>
  <span class="c1">// mutual exclusion stuff</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The improvement is two additional variants.
The <cite>scope(failure)</cite> statement is only executed if an exception is thrown.
The <cite>scope(success)</cite> statement is only executed if no exception is thrown.</p>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference external" href="http://dlang.org/statement.html#ScopeGuardStatement">Language reference on scope guards</a>,
<a class="reference external" href="http://dlang.org/exception-safe.html">Exception safety</a></p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
        </div>
        <div class="sidebar">
          <h3>Table Of Contents</h3>
          <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="hello.html">Hello World</a></li>
<li class="toctree-l1"><a class="reference internal" href="philosophy.html">Philosophy</a></li>
<li class="toctree-l1"><a class="reference internal" href="others.html">Other Languages</a></li>
<li class="toctree-l1"><a class="reference internal" href="debugging.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="documentation.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="package.html">Packaging</a></li>
<li class="toctree-l1"><a class="reference internal" href="optimization.html">Optimization</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Idiomatic D</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#constness">Constness</a></li>
<li class="toctree-l2"><a class="reference internal" href="#purity">Purity</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ranges">Ranges</a></li>
<li class="toctree-l2"><a class="reference internal" href="#compile-time-function-evaluation">Compile Time Function Evaluation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#scope-guards">Scope Guards</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="meta.html">Meta Programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="memory.html">Memory Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="c.html">C Interoperability</a></li>
<li class="toctree-l1"><a class="reference internal" href="multicores.html">Multicores</a></li>
<li class="toctree-l1"><a class="reference internal" href="collections.html">Collections</a></li>
<li class="toctree-l1"><a class="reference internal" href="unicode.html">Unicode</a></li>
<li class="toctree-l1"><a class="reference internal" href="floating.html">Floating Point</a></li>
<li class="toctree-l1"><a class="reference internal" href="stdlib.html">Standard Library: Short Tour</a></li>
<li class="toctree-l1"><a class="reference internal" href="ide.html">IDE</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui.html">GUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="next.html">What Next?</a></li>
<li class="toctree-l1"><a class="reference internal" href="fineprint.html">Fineprint</a></li>
</ul>

          <h3 style="margin-top: 1.5em;">Search</h3>
          <form class="search" action="search.html" method="get">
            <input type="text" name="q" />
            <input type="submit" value="Go" />
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
          </form>
          <p class="searchtip" style="font-size: 90%">
            Enter search terms or a module, class or function name.
          </p>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer-wrapper">
      <div class="footer">
        <div class="left">
          <a href="optimization.html" title="Optimization"
             >previous</a> |
          <a href="meta.html" title="Meta Programming"
             >next</a>
            <br/>
            <a href="_sources/idiomatic.txt"
               rel="nofollow">Show Source</a>
        </div>

        <div class="right">
          
    <div class="footer">
        &copy; Copyright 2013, Andreas Zwinkau.
      Last updated on 2014-01-11.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
        </div>
        <div class="clearer"></div>
        <div id="feedback">
          For further questions about D, ask on the <a href="http://forum.dlang.org/group/digitalmars.D.learn">D.learn forum</a>.
          For feedback on this tutorial <a href="mailto:qznc@web.de">write me an email to qznc@web.de</a>.
        </div>
        <div class="clearer"></div>
      </div>
    </div>

  </body>
</html>